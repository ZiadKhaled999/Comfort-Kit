<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com;">
    <title>Configuration - Comfort Zone</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Noto+Serif:wght@400;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#f94706",
                        "wiki-blue": "#3366cc",
                        "reddit-orange": "#FF4500",
                        "background-light": "#f8fafc",
                        "background-dark": "#0f172a",
                    },
                    fontFamily: { 
                        "display": ["Plus Jakarta Sans", "Inter", "sans-serif"],
                        "sans": ["Plus Jakarta Sans", "sans-serif"],
                        "serif": ["Noto Serif", "serif"]
                    },
                },
            },
        }
    </script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style>
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; display: inline-block; vertical-align: middle; }
        .tool-tip { visibility: hidden; opacity: 0; transition: opacity 0.2s ease, transform 0.2s ease; transform: translateY(5px); pointer-events: none; }
        .group:hover .tool-tip { visibility: visible; opacity: 1; transform: translateY(0); }
        
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.95) translateY(10px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
        .animate-pop { animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #334155; }
        
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display min-h-screen flex flex-col items-center p-6 select-text transition-colors duration-300">

    <!-- Header -->
    <div class="w-full max-w-lg bg-white dark:bg-slate-800 p-8 rounded-[2rem] shadow-xl shadow-slate-200/50 dark:shadow-none mb-6 border border-slate-100 dark:border-slate-700 transition-all">
        <div class="flex items-center gap-4 mb-2">
            <div class="size-12 bg-primary/10 rounded-2xl flex items-center justify-center text-primary">
                <span class="material-symbols-outlined text-2xl">settings</span>
            </div>
            <div>
                <h1 class="text-2xl font-black text-slate-900 dark:text-white tracking-tight">Configuration</h1>
                <p class="text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-widest">Personalize your agent</p>
            </div>
        </div>
    </div>

    <!-- Settings Form -->
    <div class="w-full max-w-lg bg-white dark:bg-slate-800 rounded-[2rem] shadow-2xl overflow-hidden animate-pop border border-slate-200 dark:border-slate-800">
        <div class="p-8 space-y-8">
            
            <!-- Engine Authentication -->
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-widest">Engine Authentication</label>
                    <input type="password" id="openrouter-key" placeholder="OpenRouter API Key (sk-or-v1-...)" class="w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl px-5 py-4 text-sm focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none text-slate-900 dark:text-white transition-all">
                </div>
                <div>
                    <label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-widest">Intelligence Model</label>
                    <select id="model-select" class="w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl px-5 py-4 text-sm outline-none text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/20 transition-all appearance-none cursor-pointer">
                        <option value="xiaomi/mimo-v2-flash:free">MiMo V2 Flash (Optimized)</option>
                        <option value="google/gemini-2.0-flash-exp:free">Gemini 2.0 Pro</option>
                        <option value="openai/gpt-4o-mini">GPT-4o Mini</option>
                        <option value="anthropic/claude-3-haiku">Claude 3 Haiku</option>
                        <option value="deepseek/deepseek-chat">DeepSeek Chat</option>
                    </select>
                </div>
            </div>

            <!-- Active Toolbox -->
            <div>
                <label class="block text-xs font-black text-slate-400 mb-4 uppercase tracking-widest">Active Toolbox</label>
                <div id="settings-tools-list" class="grid grid-cols-2 gap-3"></div>
            </div>

            <!-- Dark Mode Toggle -->
            <div class="flex items-center justify-between p-5 bg-slate-50 dark:bg-slate-900/50 rounded-2xl border border-slate-100 dark:border-slate-800">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-slate-400">dark_mode</span>
                    <div>
                        <p class="text-sm font-bold dark:text-white">Dark Interface</p>
                        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tight">OLED Optimized</p>
                    </div>
                </div>
                <button onclick="toggleDarkMode()" id="dark-mode-toggle" class="w-12 h-6 bg-slate-200 dark:bg-primary rounded-full relative transition-all duration-300">
                    <div class="absolute top-1 left-1 dark:left-7 w-4 h-4 bg-white rounded-full transition-all shadow-sm"></div>
                </button>
            </div>

            <!-- Extension Settings -->
            <div>
                <label class="block text-xs font-black text-slate-400 mb-4 uppercase tracking-widest">Extension Behavior</label>
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-sky-400">notifications</span>
                            <span class="text-xs font-black text-slate-700 dark:text-slate-300 uppercase tracking-tight">Notifications</span>
                        </div>
                        <button onclick="toggleToggle(this)" class="w-10 h-5 bg-primary rounded-full relative transition-all">
                            <div class="absolute top-1 left-6 w-3 h-3 bg-white rounded-full transition-all"></div>
                        </button>
                    </div>
                    <div class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-amber-400">auto_awesome</span>
                            <span class="text-xs font-black text-slate-700 dark:text-slate-300 uppercase tracking-tight">Auto Analyze</span>
                        </div>
                        <button onclick="toggleToggle(this)" class="w-10 h-5 bg-slate-300 dark:bg-slate-600 rounded-full relative transition-all">
                            <div class="absolute top-1 left-1 w-3 h-3 bg-white rounded-full transition-all"></div>
                        </button>
                    </div>
                    <div class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-emerald-400">history</span>
                            <span class="text-xs font-black text-slate-700 dark:text-slate-300 uppercase tracking-tight">Save History</span>
                        </div>
                        <button onclick="toggleToggle(this)" class="w-10 h-5 bg-primary rounded-full relative transition-all">
                            <div class="absolute top-1 left-6 w-3 h-3 bg-white rounded-full transition-all"></div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div>
                <label class="block text-xs font-black text-slate-400 mb-4 uppercase tracking-widest">Data Management</label>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="exportSettings()" class="flex items-center justify-center gap-2 p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800 hover:border-primary/30 transition-all">
                        <span class="material-symbols-outlined text-slate-400">download</span>
                        <span class="text-xs font-black text-slate-700 dark:text-slate-300 uppercase tracking-tight">Export</span>
                    </button>
                    <button onclick="document.getElementById('importFile').click()" class="flex items-center justify-center gap-2 p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800 hover:border-primary/30 transition-all">
                        <span class="material-symbols-outlined text-slate-400">upload</span>
                        <span class="text-xs font-black text-slate-700 dark:text-slate-300 uppercase tracking-tight">Import</span>
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importSettings(event)">
                    <button onclick="clearData()" class="flex items-center justify-center gap-2 p-4 bg-red-50 dark:bg-red-500/10 rounded-xl border border-red-100 dark:border-red-500/20 hover:bg-red-100 dark:hover:bg-red-500/20 transition-all">
                        <span class="material-symbols-outlined text-red-500">delete</span>
                        <span class="text-xs font-black text-red-500 uppercase tracking-tight">Clear All</span>
                    </button>
                    <button onclick="resetDefaults()" class="flex items-center justify-center gap-2 p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800 hover:border-slate-300 dark:hover:border-slate-600 transition-all">
                        <span class="material-symbols-outlined text-slate-400">refresh</span>
                        <span class="text-xs font-black text-slate-700 dark:text-slate-300 uppercase tracking-tight">Reset</span>
                    </button>
                </div>
            </div>

            <!-- Save Button -->
            <button onclick="saveSettings()" class="w-full py-4 bg-primary text-white rounded-2xl font-black shadow-xl shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-all uppercase tracking-widest text-xs">Synchronize Changes</button>
        </div>
        
        <!-- Footer -->
        <div class="p-6 border-t dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 text-center">
            <p class="text-xs text-slate-500 font-bold uppercase tracking-widest">Comfort Zone v1.0.0</p>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-2xl font-bold text-sm shadow-2xl opacity-0 transition-all duration-300 translate-y-4"></div>

    <script>
        const settingsToolsList = document.getElementById('settings-tools-list');
        const toast = document.getElementById('toast');
        
        let state = {
            config: { openrouterKey: "", model: "xiaomi/mimo-v2-flash:free", isDark: false },
            tools: [
                { id: 'summarize', label: 'Summarize', icon: 'auto_awesome', active: true, group: 'ai', color: 'text-amber-400' },
                { id: 'explain', label: 'Deep Explain', icon: 'psychology', active: true, group: 'ai', color: 'text-indigo-400' },
                { id: 'wiki', label: 'Wikipedia', icon: 'menu_book', active: true, group: 'search', color: 'text-sky-400' },
                { id: 'copy', label: 'Smart Copy', icon: 'content_copy', active: true, group: 'util', color: 'text-emerald-400' }
            ]
        };

        window.onload = async () => {
            const saved = await chrome.storage.local.get('mimo_research_v3');
            if (saved.mimo_research_v3) {
                state = JSON.parse(saved.mimo_research_v3);
                if (state.config.isDark) document.documentElement.classList.add('dark');
            }
            renderSettingsTools();
            document.getElementById('openrouter-key').value = state.config.openrouterKey || "";
            document.getElementById('model-select').value = state.config.model || "xiaomi/mimo-v2-flash:free";
        };

        function renderSettingsTools() {
            settingsToolsList.innerHTML = state.tools.map(tool => `
                <div class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-900/50 rounded-2xl border border-slate-100 dark:border-slate-700 transition-all">
                    <div class="flex items-center gap-3">
                        <span class="material-symbols-outlined ${tool.color}">${tool.icon}</span>
                        <span class="text-xs font-black text-slate-700 dark:text-slate-300 uppercase tracking-tight">${tool.label}</span>
                    </div>
                    <button onclick="toggleToolActive('${tool.id}')" class="w-10 h-5 ${tool.active ? 'bg-primary' : 'bg-slate-300 dark:bg-slate-600'} rounded-full relative transition-all">
                        <div class="absolute top-1 ${tool.active ? 'left-6' : 'left-1'} w-3 h-3 bg-white rounded-full transition-all"></div>
                    </button>
                </div>
            `).join('');
        }

        function toggleToolActive(id) {
            const tool = state.tools.find(t => t.id === id);
            if (tool) tool.active = !tool.active;
            renderSettingsTools();
        }

        function toggleDarkMode() {
            state.config.isDark = !state.config.isDark;
            document.documentElement.classList.toggle('dark');
        }

        function toggleToggle(btn) {
            const isActive = btn.classList.contains('bg-primary');
            if (isActive) {
                btn.classList.replace('bg-primary', 'bg-slate-300 dark:bg-slate-600');
                btn.querySelector('div').classList.replace('left-6', 'left-1');
            } else {
                btn.classList.replace('bg-slate-300 dark:bg-slate-600', 'bg-primary');
                btn.querySelector('div').classList.replace('left-1', 'left-6');
            }
        }

        async function saveSettings() {
            state.config.openrouterKey = document.getElementById('openrouter-key').value;
            state.config.model = document.getElementById('model-select').value;
            await chrome.storage.local.set({ mimo_research_v3: JSON.stringify(state) });
            showToast('Settings synchronized successfully!');
        }

        function exportSettings() {
            const data = JSON.stringify(state, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'comfort-zone-settings.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importSettings(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        state = JSON.parse(e.target.result);
                        await chrome.storage.local.set({ mimo_research_v3: JSON.stringify(state) });
                        location.reload();
                    } catch (err) {
                        showToast('Invalid settings file');
                    }
                };
                reader.readAsText(file);
            }
        }

        async function clearData() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                await chrome.storage.local.clear();
                showToast('All data cleared');
                setTimeout(() => location.reload(), 1000);
            }
        }

        function resetDefaults() {
            state = {
                config: { openrouterKey: "", model: "xiaomi/mimo-v2-flash:free", isDark: false },
                tools: [
                    { id: 'summarize', label: 'Summarize', icon: 'auto_awesome', active: true, group: 'ai', color: 'text-amber-400' },
                    { id: 'explain', label: 'Deep Explain', icon: 'psychology', active: true, group: 'ai', color: 'text-indigo-400' },
                    { id: 'wiki', label: 'Wikipedia', icon: 'menu_book', active: true, group: 'search', color: 'text-sky-400' },
                    { id: 'copy', label: 'Smart Copy', icon: 'content_copy', active: true, group: 'util', color: 'text-emerald-400' }
                ]
            };
            renderSettingsTools();
            document.getElementById('openrouter-key').value = "";
            document.getElementById('model-select').value = "xiaomi/mimo-v2-flash:free";
            showToast('Defaults restored');
        }

        function showToast(message) {
            toast.textContent = message;
            toast.style.opacity = '1';
            toast.style.transform = 'translate(-50%, 0)';
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translate(-50%, 20px)';
            }, 3000);
        }
    </script>
</body>
</html>
